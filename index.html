<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <title>Truck Game</title>
  <link rel="manifest" href="manifest.json" />

  <style>
    :root {
      --control-bg: rgba(0, 0, 0, 0.72);
      --control-border: #444;
      --control-text: #fff;
      --control-active: #2fa36a;
    }

    html,
    body {
      width: 100%;
      height: 100%;
    }

    body {
      margin: 0;
      overflow: hidden;
      background: #000;
      font-family: monospace;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .game-shell {
      position: relative;
      width: 100vw;
      height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      background: #000;
    }

    canvas {
      display: block;
      background: #000;
      max-width: 100vw;
      max-height: 100vh;
    }

    .touch-controls {
      position: absolute;
      inset: 0;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: flex-end;
      gap: 12px;
      padding: 16px 16px calc(24px + env(safe-area-inset-bottom, 16px)) 16px;
      box-sizing: border-box;
      background: linear-gradient(180deg, rgba(0, 0, 0, 0) 55%, rgba(0, 0, 0, 0.4) 100%);
    }

    .touch-row {
      display: flex;
      gap: 12px;
    }

    .touch-btn {
      min-width: 110px;
      padding: 12px 16px;
      border-radius: 12px;
      background: var(--control-bg);
      color: var(--control-text);
      border: 1px solid var(--control-border);
      font-family: monospace;
      font-size: 14px;
      letter-spacing: 0.5px;
      text-transform: uppercase;
      backdrop-filter: blur(4px);
      touch-action: manipulation;
    }

    .touch-btn:active,
    .touch-btn.pressed {
      background: var(--control-active);
      color: #000;
      border-color: #3dd185;
    }

    @media (pointer: fine) {
      .touch-controls {
        display: none;
      }
    }

    /* Mini-map overlay */
    #mini-map-container {
      position: absolute;
      top: 12px;
      left: 12px;
      width: 150px;
      padding: 8px;
      background: rgba(0, 0, 0, 0.6);
      border: 1px solid rgba(255, 255, 255, 0.25);
      border-radius: 8px;
      box-shadow: 0 8px 20px rgba(0, 0, 0, 0.35);
      pointer-events: none;
      z-index: 20;
    }

    #mini-map-svg {
      width: 100%;
      height: auto;
      display: block;
    }

    #mini-map-outline {
      fill: rgba(255, 255, 255, 0.08);
      stroke: rgba(255, 255, 255, 0.45);
      stroke-width: 1.8;
      stroke-linejoin: round;
    }

    #mini-map-dot {
      fill: #2fa36a;
      stroke: rgba(0, 0, 0, 0.6);
      stroke-width: 1.5;
      filter: drop-shadow(0 0 4px rgba(47, 163, 106, 0.8));
    }


    /* ==========================================
       DOT WHEEL OVERLAY - HIGH TECH HUD
    ========================================== */

    #dot-wheel-overlay {
      position: fixed;
      inset: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      background: radial-gradient(circle at center, rgba(0, 255, 255, 0.18), rgba(0,0,0,0.9));
      z-index: 50;
      transition: opacity 0.25s ease-out, transform 0.25s ease-out;
    }

    #dot-wheel-overlay.dot-hidden {
      pointer-events: none;
      opacity: 0;
      transform: translateY(-12px);
    }

    .dot-panel {
      width: min(720px, 95vw);
      padding: 18px 20px 20px;
      border-radius: 14px;
      background: radial-gradient(circle at top, #092432 0, #02050a 55%, #000 100%);
      border: 1px solid rgba(0, 255, 255, 0.4);
      box-shadow: 0 0 30px rgba(0, 255, 255, 0.45);
      display: flex;
      flex-direction: column;
      gap: 12px;
      position: relative;
      overflow: hidden;
    }

    .dot-panel::before {
      content: "";
      position: absolute;
      inset: 0;
      background-image:
        linear-gradient(to bottom, rgba(0,255,255,0.08), transparent 40%),
        linear-gradient(120deg, rgba(0,255,255,0.07), transparent 65%);
      mix-blend-mode: screen;
      pointer-events: none;
    }

    .dot-police-lights {
      display: flex;
      gap: 10px;
      align-items: center;
      justify-content: center;
      padding: 6px 0 4px;
      position: relative;
      z-index: 2;
    }

    .dot-light {
      width: 16px;
      height: 16px;
      border-radius: 4px;
      box-shadow: 0 0 12px currentColor;
      animation: dot-light-pulse 1s infinite alternate;
    }

    .dot-light.red {
      color: #ff4b4b;
      background: #ff4b4b;
      animation-delay: 0s;
    }

    .dot-light.blue {
      color: #4bb0ff;
      background: #4bb0ff;
      animation-delay: 0.5s;
    }

    @keyframes dot-light-pulse {
      from { opacity: 0.5; transform: translateY(0); }
      to   { opacity: 1;   transform: translateY(-2px); }
    }

    .dot-header {
      position: relative;
      z-index: 1;
      display: flex;
      flex-direction: column;
      gap: 4px;
      border-bottom: 1px solid rgba(0, 255, 255, 0.3);
      padding-bottom: 6px;
    }

    .dot-title {
      font-size: 16px;
      letter-spacing: 2px;
      text-transform: uppercase;
      color: #7dfff7;
    }

    .dot-sub {
      font-size: 11px;
      color: #84b7ff;
      opacity: 0.9;
    }

    .dot-content {
      position: relative;
      z-index: 1;
      display: flex;
      gap: 16px;
      align-items: center;
      justify-content: center;
      flex-wrap: wrap;
    }

    #dot-wheel-canvas {
      width: 260px;
      height: 260px;
      max-width: 45vw;
      max-height: 45vw;
      background: radial-gradient(circle at center, #021018 0, #000 70%);
      border-radius: 50%;
      border: 1px solid rgba(0,255,255,0.4);
      box-shadow: 0 0 22px rgba(0,255,255,0.5);
    }

    .dot-info {
      min-width: 220px;
      max-width: 320px;
      display: flex;
      flex-direction: column;
      gap: 10px;
      color: #cfe9ff;
      font-size: 13px;
    }

    #dot-result-line {
      min-height: 46px;
      line-height: 1.3;
    }

    #dot-spin-btn {
      align-self: flex-start;
      padding: 10px 22px;
      border-radius: 999px;
      border: 1px solid rgba(0,255,255,0.8);
      background: radial-gradient(circle at top, #0ff 0, #007a7a 55%, #003b3b 100%);
      color: #001014;
      font-family: monospace;
      font-size: 14px;
      letter-spacing: 1.5px;
      text-transform: uppercase;
      cursor: pointer;
      box-shadow: 0 0 16px rgba(0,255,255,0.75);
      transition: transform 0.08s ease-out, box-shadow 0.08s ease-out, filter 0.08s;
    }

    #dot-spin-btn:active {
      transform: scale(0.96);
      box-shadow: 0 0 6px rgba(0,255,255,0.55);
      filter: brightness(0.9);
    }

    @media (max-width: 640px) {
      .dot-panel {
        padding: 14px 12px 14px;
      }
      .dot-title {
        font-size: 14px;
      }
      #dot-wheel-canvas {
        width: 220px;
        height: 220px;
      }
    }
  </style>
</head>

<body>

  <div class="game-shell">
    <!-- The main game canvas -->
    <canvas id="game" width="960" height="540"></canvas>

    <div class="touch-controls" aria-label="Mobile controls">
    <div class="touch-row">
      <button class="touch-btn" data-key="ArrowLeft" aria-label="Steer left">Left</button>
      <button class="touch-btn" data-key="ArrowRight" aria-label="Steer right">Right</button>
    </div>
    <div class="touch-row">
      <button class="touch-btn" data-key="ArrowUp" aria-label="Accelerate">Accelerate</button>
      <button class="touch-btn" data-key="ArrowDown" aria-label="Brake">Brake</button>
    </div>
  </div>

    <div id="mini-map-container" aria-label="Mini map">
      <svg id="mini-map-svg" viewBox="0 0 200 120" role="img" aria-label="United States outline">
        <path id="mini-map-outline" d="M14 76 L22 52 L40 38 L70 32 L100 24 L128 32 L150 38 L170 36 L186 52 L182 70 L164 82 L140 84 L114 78 L90 88 L62 92 L40 90 L22 84 Z" />
        <circle id="mini-map-dot" cx="100" cy="60" r="4" />
      </svg>
    </div>

  </div>

  <div id="dot-wheel-overlay" class="dot-hidden">
    <div class="dot-panel">
      <div class="dot-police-lights" aria-hidden="true">
        <div class="dot-light red"></div>
        <div class="dot-light blue"></div>
      </div>
      <div class="dot-header">
        <span class="dot-title">DOT RANDOM INTERVENTION</span>
        <span class="dot-sub">Automated Compliance Analyzer v4.1</span>
      </div>
      <div class="dot-content">
        <canvas id="dot-wheel-canvas" width="320" height="320"></canvas>
        <div class="dot-info">
          <div id="dot-result-line">
            Press SPIN to begin automated inspection...
          </div>
          <button id="dot-spin-btn">SPIN</button>
        </div>
      </div>
    </div>
  </div>

  <!-- ========================================================= -->
  <!--  LOAD ORDER (DO NOT TOUCH unless we update engine again) -->
  <!-- ========================================================= -->

  <!-- 1. Static data for cities, regions, distances -->
  <script src="src/data.js"></script>

  <!-- 2. World map logic (city coordinates, region assignment) -->
  <script src="src/worldmap.js"></script>

  <!-- 2.5 Background metadata -->
  <script src="src/backgrounds.js"></script>

  <!-- 3. Core game engine (fuel, DOT, jobs, driving loop, weather) -->
  <script src="src/engine.js"></script>

  <!-- 4. Random event system (breakdowns, DOT events, weather spikes) -->
  <script src="src/events.js"></script>

  <!-- 4.5 DOT wheel overlay -->
  <script src="src/dot_wheel.js"></script>

  <!-- 4.6 Background rendering -->
  <script src="src/render_background.js"></script>

  <!-- 5. UI code (HUD, tooltips, city popups, upgrade hover, panels) -->
  <script src="src/ui.js"></script>

  <!-- 6. Render pipeline (sky, road, truck, mountains, weather graphics) -->
  <script src="src/render.js"></script>

  <!-- 7. Mini map overlay -->
  <script src="src/minimap.js"></script>

  <!-- ========================================================= -->
  <!--  SERVICE WORKER (PWA SUPPORT)                            -->
  <!-- ========================================================= -->
  <script>
    if ("serviceWorker" in navigator) {
      window.addEventListener("load", () => {
        navigator.serviceWorker.register("service-worker.js")
          .then(reg => console.log("SW registered:", reg.scope))
          .catch(err => console.warn("SW failed:", err));
      });
    }
  </script>

</body>
</html>
